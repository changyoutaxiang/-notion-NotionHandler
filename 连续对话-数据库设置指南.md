# 连续对话功能 - Notion数据库设置指南

## 🎯 概览

为了启用连续对话功能，你需要在现有的Notion数据库中添加6个新字段。这个过程非常简单，不会影响现有数据。

## 📋 必需字段列表

### 1. 会话ID (session_id)
- **字段类型**: Text (文本)
- **字段名称**: `会话ID`
- **作用**: 标识对话会话，系统自动生成
- **用户操作**: 无需手动填写，系统自动处理

### 2. 父消息ID (parent_id)  
- **字段类型**: Text (文本)
- **字段名称**: `父消息ID`
- **作用**: 指向上一条消息，建立对话链
- **用户操作**: 继续对话时需要填写（复制上一条消息的页面ID）

### 3. 会话状态 (session_status)
- **字段类型**: Select (选择)
- **字段名称**: `会话状态`
- **选项设置**:
  - `active` (活跃)
  - `closed` (已关闭)
  - `archived` (已归档)
- **作用**: 管理对话生命周期
- **用户操作**: 可选，系统默认设为active

### 4. 对话轮次 (conversation_turn)
- **字段类型**: Number (数字)
- **字段名称**: `对话轮次`
- **作用**: 记录当前对话的轮次
- **用户操作**: 无需手动填写，系统自动计算

### 5. 会话标题 (session_title)
- **字段类型**: Text (文本)
- **字段名称**: `会话标题`
- **作用**: 为对话会话设置易识别的标题
- **用户操作**: 可选，便于管理多个对话

### 6. 上下文长度 (context_length)
- **字段类型**: Number (数字)
- **字段名称**: `上下文长度`
- **作用**: 记录当前对话的上下文字符数
- **用户操作**: 无需手动填写，系统自动计算

## 🔧 添加字段步骤

### 步骤1：打开数据库设置
1. 进入你的Notion LLM数据库页面
2. 点击数据库右上角的`···`菜单
3. 选择`Properties` (属性)

### 步骤2：添加新字段
对于每个字段，执行以下操作：

1. 点击`+ Add a property` (添加属性)
2. 输入字段名称（使用上面列表中的确切名称）
3. 选择对应的字段类型
4. 对于Select类型字段，添加相应的选项
5. 点击`Done` (完成)

### 步骤3：验证设置
添加完成后，你的数据库应该包含以下字段：

**原有字段** (保持不变):
- 标题
- 输入
- 回复
- 模版
- 背景
- 类型

**新增字段** (连续对话功能):
- 会话ID
- 父消息ID
- 会话状态
- 对话轮次
- 会话标题
- 上下文长度

## 🚀 使用方法

### 开始新对话
1. 像以前一样创建新条目
2. 填写输入内容，选择模版/背景/类型
3. 系统自动创建新会话，生成会话ID

### 继续对话
1. 创建新条目
2. 在`父消息ID`字段中填写上一条消息的页面ID
3. 填写新的输入内容
4. 系统自动继承对话历史，生成连续回复

### 获取页面ID方法
1. 打开上一条消息的页面
2. 复制浏览器地址栏中的URL
3. 提取其中的页面ID部分（32位字符串）
4. 或者右键页面，选择"Copy link"，从链接中提取ID

## 💡 使用技巧

### 1. 快速继续对话
- 可以在上一条消息页面中直接复制页面ID
- 建议为长对话设置清晰的会话标题

### 2. 管理对话会话
- 使用会话状态字段标记对话状态
- 定期将旧对话标记为"archived"

### 3. 监控对话长度
- 注意上下文长度字段，避免过长的对话导致性能下降
- 建议单个会话控制在10轮以内

## ⚠️ 注意事项

1. **向后兼容**: 原有功能完全不受影响，现有数据依然正常工作
2. **可选功能**: 如果不使用连续对话，新字段可以留空
3. **字段名称**: 必须使用指南中指定的确切字段名称
4. **性能影响**: 连续对话会增加处理时间，建议合理使用

## 🔍 故障排除

### 连续对话不生效
- 检查字段名称是否完全一致
- 确认父消息ID格式正确
- 查看系统日志输出

### 页面ID获取困难
- 可以使用Notion的分享功能获取页面链接
- 页面ID通常是32位长度的字符串

## 📞 技术支持

如果在设置过程中遇到问题，请：
1. 检查字段名称和类型是否正确
2. 确认配置文件中的字段映射
3. 查看系统启动日志中的连续对话相关信息

---

**🎉 设置完成后，你的Notion-LLM系统就支持连续对话功能了！** 