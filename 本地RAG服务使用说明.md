# 本地RAG服务使用说明

> **🎯 目标：让RAG能力在后台静默运行，无需打开GUI界面**

## 🚀 一键启动（推荐）

### 方法1：双击启动 （最简单）
1. 在项目文件夹中找到 `启动RAG后台服务.sh`
2. **双击运行**
3. 等待提示"RAG后台服务启动成功"
4. **关闭终端窗口** - 服务继续在后台运行

### 方法2：终端启动
```bash
# 在项目目录下执行
bash 启动RAG后台服务.sh
```

## 📋 服务管理命令

### 查看服务状态
```bash
python3 start_local_rag_service.py status
```
显示：
- ✅/❌ 服务运行状态
- 📋 服务地址 (http://127.0.0.1:8001)
- 💚 健康检查状态
- 📄 日志文件位置

### 停止服务
```bash
python3 start_local_rag_service.py stop
```

### 重启服务
```bash
python3 start_local_rag_service.py restart
```

## 🔍 服务验证

### 1. 状态检查
服务启动后，访问：http://127.0.0.1:8001/health

应该返回：
```json
{
  "status": "healthy",
  "service": "Local RAG Service", 
  "version": "1.0.0",
  "rag_engine_ready": true
}
```

### 2. RAG测试
```bash
curl -X POST "http://127.0.0.1:8001/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "如何提高工作效率", "max_results": 3}'
```

## ⚠️ 重要说明

### 🔄 服务持久性
- ✅ **后台运行**：关闭终端窗口后服务继续运行
- ❌ **重启失效**：电脑重启后需要重新启动服务
- ✅ **稳定运行**：正常使用下服务可连续运行数天

### 📊 资源占用
- **内存**：约2-4GB（首次加载AI模型时）
- **CPU**：空闲时几乎无占用，检索时短暂占用
- **端口**：占用本地端口8001

### 🛡️ 安全说明
- 服务仅监听本地地址(127.0.0.1)
- 外部网络无法访问
- 不会泄露任何数据

## 🔧 故障排除

### 问题1：服务启动失败
**可能原因**：
- RAG配置未启用
- 依赖包缺失
- 端口8001被占用

**解决方案**：
1. 检查`config.json`中`rag_system.enabled`是否为`true`
2. 运行：`pip install -r requirements-full.txt`
3. 运行：`lsof -i :8001`检查端口占用

### 问题2：健康检查失败
**解决方案**：
1. 等待30-60秒（AI模型加载需要时间）
2. 查看日志：`tail -f logs/rag_service.log`
3. 重启服务：`python3 start_local_rag_service.py restart`

### 问题3：RAG检索无结果
**可能原因**：
- 知识库文件为空
- 向量索引未构建

**解决方案**：
1. 检查`knowledge_base/`目录是否有.md文件
2. 删除`vector_cache/`目录并重启服务

## 💡 使用建议

### 🌟 最佳实践
1. **开机启动**：每次开机后先运行一次启动脚本
2. **定期检查**：每周运行一次`status`命令检查服务状态
3. **定期重启**：每月重启一次服务清理内存

### 🔄 与现有GUI的关系
- **后台服务**：负责RAG检索，API接口
- **GUI程序**：负责Notion监听，用户界面
- **可并存**：两者可以同时运行，互不影响

## 📈 性能表现

### ⚡ 响应速度
- **健康检查**：< 50ms
- **RAG检索**：100-500ms（取决于查询复杂度）
- **首次启动**：30-60秒（加载AI模型）

### 🧠 智能能力
- **语义理解**：支持中文语义搜索
- **上下文构建**：自动提取相关知识片段
- **结果排序**：智能相关性排序

---

## 🎉 快速开始

1. **双击** `启动RAG后台服务.sh`
2. **等待** "RAG后台服务启动成功" 提示
3. **关闭** 终端窗口
4. **完成** - RAG服务已在后台运行！

> 💡 **提示**：服务启动后，你的混合架构就具备了本地RAG能力！ 